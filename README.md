# Установка и настройка NTP (chrony)

Скрипт автоматической настройки NTP-сервера с помощью chrony для AlmaLinux, Debian и Ubuntu.

## Возможности

- Установка chrony
- Настройка временной зоны (Europe/Moscow)
- Конфигурирование серверов NTP (ru.pool.ntp.org)
- Открытие порта 123/UDP в firewall (firewalld или ufw)
- Настройка локали времени для Debian/Ubuntu
- Проверка статуса синхронизации

## Использование

Запустите скрипт с помощью `sudo`:

```bash
sudo ./setup_ntp.sh
```

## Основные команды диагностики

- Проверка статуса синхронизации:
    ```bash
    chronyc tracking
    ```

- Список NTP-серверов:
    ```bash
    chronyc sources -v
    chronyc sourcestats -v
    ```

- Принудительная синхронизация:
    ```bash
    chronyc makestep
    ```

## check_ntp_sync.sh — автоматическая проверка и коррекция времени

Скрипт `check_ntp_sync.sh` предназначен для автоматического мониторинга расхождения системного времени и его коррекции при превышении порога.

**Принцип работы:**
- Получает текущее расхождение времени через `chronyc tracking`
- Если расхождение превышает 300 секунд (5 минут), выполняет принудительную синхронизацию (`chronyc makestep`)
- Перезапускает службу `chronyd` для надежности
- Все действия и ошибки логируются в `/var/log/ntp_fix.log`

**Рекомендации по установке:**
1. Скопируйте скрипт в `/usr/local/bin/` и сделайте исполняемым:
    ```bash
    cp check_ntp_sync.sh /usr/local/bin/
    chmod +x /usr/local/bin/check_ntp_sync.sh
    ```
2. Добавьте запуск в cron для регулярной проверки (например, каждые 5 минут):
    ```bash
    crontab -e
    ```

    ```
    */5 * * * * /usr/local/bin/check_ntp_sync.sh
    ```

**Логирование:**  
Все события записываются в `/var/log/ntp_fix.log` для последующего анализа.

---